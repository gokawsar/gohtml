l<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Class Routine Visualizer</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }
    #controls { margin-bottom: 20px; }
    table { border-collapse: collapse; width: 100%; margin: 10px 0; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
    th { background: #f0f0f0; }
    .timetable { margin-top: 30px; }
    .warning { color: red; font-weight: bold; }
    .course-list, .my-plan { max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <h1>Semester Routine Visualizer</h1>

  <div id="controls">
    <label>Search: <input type="text" id="searchBox" placeholder="Search courses..."></label>
    <label>Max Credits: <input type="number" id="maxCredits" value="19" min="1"></label>
    <button onclick="resetPlan()">Reset Plan</button>
  </div>

  <h2>Available Courses</h2>
  <div class="course-list">
    <table id="courseTable">
      <thead>
        <tr>
          <th>Category</th>
          <th>Course Name</th>
          <th>Section</th>
          <th>Credits</th>
          <th>Day</th>
          <th>Slot</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <h2>My Semester Plan</h2>
  <div class="my-plan">
    <table id="planTable">
      <thead>
        <tr>
          <th>Course</th>
          <th>Section</th>
          <th>Credits</th>
          <th>Day</th>
          <th>Slot</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <p>Total Credits: <span id="totalCredits">0</span> / <span id="limitCredits">19</span></p>
  <p id="warningMsg" class="warning"></p>

  <h2>Weekly Timetable</h2>
  <div class="timetable">
    <table id="timetable">
      <thead>
        <tr>
          <th>Time Slot</th>
          <th>Saturday</th>
          <th>Sunday</th>
          <th>Monday</th>
          <th>Tuesday</th>
          <th>Wednesday</th>
          <th>Thursday</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
let courseData = [];
let selectedPlan = JSON.parse(localStorage.getItem("myPlan")) || [];

// Load Excel
fetch("full_routine.xlsx").then(res => res.arrayBuffer()).then(data => {
  let wb = XLSX.read(new Uint8Array(data), { type: "array" });
  let sheet = wb.Sheets[wb.SheetNames[0]];
  courseData = XLSX.utils.sheet_to_json(sheet);
  renderCourses(courseData);
  renderPlan();
});

// Render course list
function renderCourses(data) {
  let tbody = document.querySelector("#courseTable tbody");
  tbody.innerHTML = "";
  data.forEach((c, idx) => {
    let tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${c.Category || ""}</td>
      <td>${c.Course || ""}</td>
      <td>${c.Section || ""}</td>
      <td>${c.Credits || 0}</td>
      <td>${c.Day || ""}</td>
      <td>${c.Slot || ""}</td>
      <td><button onclick="addCourse(${idx})">Add</button></td>
    `;
    tbody.appendChild(tr);
  });
}

// Add course
function addCourse(idx) {
  let c = courseData[idx];
  if (hasConflict(c)) {
    alert("Conflict detected with existing selection!");
    return;
  }
  selectedPlan.push(c);
  savePlan();
  renderPlan();
}

// Remove course
function removeCourse(i) {
  selectedPlan.splice(i,1);
  savePlan();
  renderPlan();
}

// Render plan
function renderPlan() {
  let tbody = document.querySelector("#planTable tbody");
  tbody.innerHTML = "";
  let total = 0;
  selectedPlan.forEach((c, i) => {
    total += parseInt(c.Credits || 0);
    let tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${c.Course}</td>
      <td>${c.Section}</td>
      <td>${c.Credits}</td>
      <td>${c.Day}</td>
      <td>${c.Slot}</td>
      <td><button onclick="removeCourse(${i})">Remove</button></td>
    `;
    tbody.appendChild(tr);
  });
  document.getElementById("totalCredits").innerText = total;
  document.getElementById("limitCredits").innerText = document.getElementById("maxCredits").value;
  document.getElementById("warningMsg").innerText = total > document.getElementById("maxCredits").value ? "Credit limit exceeded!" : "";
  renderTimetable();
}

// Conflict detection
function hasConflict(newCourse) {
  return selectedPlan.some(c => c.Day===newCourse.Day && c.Slot===newCourse.Slot);
}

// Render timetable
function renderTimetable() {
  let tbody = document.querySelector("#timetable tbody");
  tbody.innerHTML = "";
  let slots = ["Slot 1","Slot 2","Slot 3","Slot 4","Slot 5"];
  slots.forEach(slot => {
    let tr = document.createElement("tr");
    tr.innerHTML = `<td>${slot}</td>`;
    ["Saturday","Sunday","Monday","Tuesday","Wednesday","Thursday"].forEach(day => {
      let c = selectedPlan.find(x => x.Day===day && x.Slot===slot);
      tr.innerHTML += `<td>${c ? c.Course+" ("+c.Section+")" : ""}</td>`;
    });
    tbody.appendChild(tr);
  });
}

// Save/reset
function savePlan() { localStorage.setItem("myPlan", JSON.stringify(selectedPlan)); }
function resetPlan() { selectedPlan=[]; savePlan(); renderPlan(); }

// Search
document.getElementById("searchBox").addEventListener("input", e => {
  let q = e.target.value.toLowerCase();
  renderCourses(courseData.filter(c =>
    (c.Course||"").toLowerCase().includes(q) ||
    (c.Section||"").toLowerCase().includes(q) ||
    (c.Category||"").toLowerCase().includes(q) ||
    (c.Day||"").toLowerCase().includes(q)
  ));
});

// Credit limit update
document.getElementById("maxCredits").addEventListener("change", renderPlan);
</script>
</body>
</html>